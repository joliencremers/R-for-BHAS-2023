---
title: "Practical C - walkthrough"
author: "Statistical Programming with R"
date: ""
output: html_document

---
#### Exercises
In this exercise we will learn to use packages and write data to/from external sources

---

1. **Install the package called "RSQLite" using the console and skim the console-output.** 

To install packages we use the function `install.packages`
```{r eval = FALSE}
install.packages("RSQLite")
```

There is a lot of text in the output, including the website where the package is fetched from and
the path it is installed to. If the package depended on other packages they would
also be shown here. If the package is already installed and up-to-date it will
not be installed again, but a short information will be shown here.

---

2. **Load the package `dplyr` and read the output in the console. What do you think it means?**

We load a packages with the function `library`
```{r message = TRUE}
library(dplyr)
```

It informs us that dplyr is masking the functions `filter` and `lag` from the 
package `stats`. This is because there is a naming conflict. Both `dplyr` and 
`stats` has functions by those names, so when you write `filter` in the console
`R` does not know which one to choose. To avoid this the latest package you loaded
masks the others, so in this case when you write `filter` it will use the function 
from the `dplyr` package.  
To be helpful `library` prints this informational message to avoid confusion.

---

3. **Open the vignette for the package `DBI`. If you do not have it installed, do so. This might come in handy later**

```{r eval = FALSE}
browseVignettes("DBI")
```

---

4. **Together with 3-4 coleagues make a dataframe with three columns. One column should be a character column with your names. The second column should be a numeric column with your shoe size. The third column should be a logical columnd with `TRUE` if you have used `R` before and `FALSE` if you have not. Assign the dataframe to a name you choose yourselves**

To create the dataframe use the function `data.frame`. Speak with your colleagues
to get values for your dataframe.
```{r}
personal_data <- data.frame(names = c("Morten", "Philip", "Karen", "Emil"),
                            shoe_size = c(45, 46, 41, 42),
                            used_r = c(TRUE, TRUE, TRUE, TRUE))
```
Here it is possible to make problems with the names. Spaces should be avoided and
it is a convention to use snakecase (words seperated by _).

---

5. **Write your dataframe to an excel-file (.xlsx).**

Use the function `xlsx::write.xlsx` (remember the `::`-notation? It is to avoid 
loading the entire package). Remember the `row.names = FALSE` argument! (What happens if your forget it?)
```{r}
xlsx::write.xlsx(personal_data,
                 "personal_file.xlsx",
                 row.names = FALSE)
```

----

6. **Open your file in Excel and edit a value. Save it and load it back into R. Does it look like you expected?**

Hopefully you have excel installed, else this exercise will is difficult. But
you can read the data into R using the function `read_xlsx`. It is from the `readxl`
package, so if you have not loaded it yet, do so.
```{r}
library(readxl)
read_xlsx("personal_file.xlsx")
```

As you can see the logical column has switched from logical to character. This
is a classical problem when switching between formats. In this case it is because
Excel doesn't recognise R's logical datatype. It is always a good idea
to check your data when reading from external sources.

---

7 **Open a connection to a SQLite database and write the dataset to it using the functions from the lecture. Check that there is a table created in the database.**

RSQLite is a lightweight database that R can create for us, so we use it as an
example here. It will automatically be created when we try to connect to it.
Use the function `dbConnect` to from the package `DBI` to open the connection:
```{r}
library(DBI)
con <- dbConnect(RSQLite::SQLite(),
                 name = "my_personal_database")
```

We now have an open connection to our database.  

To write our dataset to the database we use the function `dbWriteTable`. Check 
the help page for the function to see the arguments.
```{r}
dbWriteTable(conn = con,
             name = "my_tablename",
             value = personal_data)
```

`dbWriteTable` just returns a logical value `TRUE` if it succeeded. But to make 
sure that the table with our data has been created, use the function `dbListTables`
```{r}
dbListTables(con)
```

If the name of your table does not show up, something went wrong.

---

8. **Read the dataset from the database back into R and inspect it. Does it look like you expected?** 

To read the full dataset we use the function `dbReadTable`. It takes two required
arguments: A connection to a database and the name of the table you want to read:
```{r}
personal_data_from_db <- dbReadTable(conn = con,
                                     name = "my_tablename")
```

Inspect the data either by printing it in the console or use the `View`-function.
You will see that once again, the logical column has changed datatype. This time
to a numeric/integer.

9. **Remove your table from the database and disconnect**
```{r}
dbRemoveTable(con, "my_tablename")
dbDisconnect(con)
```

---

End of practical

